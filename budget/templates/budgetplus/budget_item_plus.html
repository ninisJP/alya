{% include 'partials/budget_item_plus_css.html' %}

<div id="budget_item_plus">
    <form method="POST" hx-post="{% url 'budget_item_update' budget.id %}" hx-target="#budget_item_plus" hx-swap="outerHTML">
        {% csrf_token %}
        <div class="card mt-4 shadow-sm">
            <div class="card-body p-0">
                <table class="table excel-table">
                    <thead>
                        <tr>
                            <th class="letter-header"></th>
                            {% for col in 'ABCDEFGHIJK' %}
                            <th class="letter-header">{{ col }}</th>
                            {% endfor %}
                        </tr>
                        <tr>
                            <th class="letter-header">#</th>
                            <th>SAP</th>
                            <th>CAT.</th>
                            <th>ITEM</th>
                            <th>UND</th>
                            <th>CANT</th>
                            <th>HORAS</th>
                            <th>PRECIO H.</th>
                            <th>PRECIO D.</th>
                            <th>PRECIO U.</th>
                            <th>PRECIO P.</th>
                            <th>ACT</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in items %}
                        <tr id="item-{{ item.id }}">
                            <td class="row-number">{{ loop.index }}</td>
                            <td>{{ item.item.sap }}</td>
                            <td>{{ item.item.category }}</td>
                            <td>{{ item.item.description }}</td>
                            <td>
                                <input 
                                    type="text" 
                                    name="unit_{{ item.id }}" 
                                    value="{{ item.unit }}" 
                                    class="form-control update-trigger"
                                    hx-post="{% url 'budget_item_update' budget.id %}"
                                    hx-target="#budget_item_plus"
                                    hx-swap="outerHTML"
                                    hx-trigger="keyup changed delay:2s"
                                >
                            </td>
                            <td>
                                <input 
                                    type="number" 
                                    name="quantity_{{ item.id }}" 
                                    value="{{ item.quantity }}" 
                                    class="form-control update-trigger"
                                    hx-post="{% url 'budget_item_update' budget.id %}"
                                    hx-target="#budget_item_plus"
                                    hx-swap="outerHTML"
                                    hx-trigger="keyup changed delay:2s"
                                >
                            </td>
                            <td>
                                <input 
                                    type="number" 
                                    name="custom_quantity_{{ item.id }}" 
                                    value="{{ item.custom_quantity|default:0 }}" 
                                    class="form-control update-trigger"
                                    hx-post="{% url 'budget_item_update' budget.id %}"
                                    hx-target="#budget_item_plus"
                                    hx-swap="outerHTML"
                                    hx-trigger="keyup changed delay:2s"
                                >
                            </td>
                            <td>
                                <input 
                                    type="number" 
                                    name="custom_price_per_hour_{{ item.id }}" 
                                    value="{{ item.custom_price_per_hour|default:0 }}" 
                                    class="form-control update-trigger"
                                    hx-post="{% url 'budget_item_update' budget.id %}"
                                    hx-target="#budget_item_plus"
                                    hx-swap="outerHTML"
                                    hx-trigger="keyup changed delay:2s"
                                >
                            </td>
                            <td>
                                <input 
                                    type="number" 
                                    name="custom_price_per_day_{{ item.id }}" 
                                    value="{{ item.custom_price_per_day }}" 
                                    class="form-control update-trigger"
                                    hx-post="{% url 'budget_item_update' budget.id %}"
                                    hx-target="#budget_item_plus"
                                    hx-swap="outerHTML"
                                    hx-trigger="keyup changed delay:2s"
                                >
                            </td>
                            <td>
                                <input 
                                    type="number" 
                                    name="custom_price_{{ item.id }}" 
                                    value="{{ item.custom_price }}" 
                                    class="form-control update-trigger"
                                    hx-post="{% url 'budget_item_update' budget.id %}"
                                    hx-target="#budget_item_plus"
                                    hx-swap="outerHTML"
                                    hx-trigger="keyup changed delay:2s"
                                >
                            </td>
                            <td><span class="total-price" id="total-price-{{ item.id }}">{{ item.total_price }}</span></td>
                            <td>
                                <button 
                                    class="btn btn-danger btn-sm" 
                                    hx-delete="{% url 'budget_item_delete' item.id %}" 
                                    hx-target="#item-{{ item.id }}" 
                                    hx-swap="outerHTML">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </form>
</div>

{% include 'partials/budget_item_plus_js.html' %}
